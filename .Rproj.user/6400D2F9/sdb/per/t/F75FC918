{
    "collab_server" : "",
    "contents" : "library(stringr)\nlibrary(dplyr)\nlibrary(tidyr)\n\nlibrary(rgeos)\nlibrary(maptools)\nlibrary(ggplot2)   # devtools::install_github(\"hadley/ggplot2\") only if you want subtitles/captions\nlibrary(ggalt)\nlibrary(ggthemes)\nlibrary(albersusa) # devtools::install_github(\"hrbrmstr/albersusa\")\nlibrary(viridis)\nlibrary(scales)\n\nsahie2013 <- read.csv(\"data/sahie_2013.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2013$State.Name <- str_trim(sahie2013$State.Name)\nsahie2014 <- read.csv(\"data/sahie_2014.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2014$State.Name <- str_trim(sahie2014$State.Name)\n\nsahie2013$statefips <- as.character(sahie2013$statefips)\nsahie2013$countyfips <- as.character(sahie2013$countyfips)\n\nsahie2013$statefips <- ifelse(nchar(sahie2013$statefips) == 1, paste0(\"0\", sahie2013$statefips), sahie2013$statefips)\nsahie2013$countyfips <- ifelse(nchar(sahie2013$countyfips) == 1, paste0(\"00\", sahie2013$countyfips), sahie2013$countyfips)\nsahie2013$countyfips <- ifelse(nchar(sahie2013$countyfips) == 2, paste0(\"0\", sahie2013$countyfips), sahie2013$countyfips)\nsahie2013$countyfips <- ifelse(nchar(sahie2013$countyfips) == 3, sahie2013$countyfip, sahie2013$countyfips)\nsahie2013$fips <- paste0(sahie2013$statefips, sahie2013$countyfips)\nct_sahie_2013 <- subset(sahie2013, State.Name==\"Connecticut\")\n\n\nsahie2014$statefips <- as.character(sahie2014$statefips)\nsahie2014$countyfips <- as.character(sahie2014$countyfips)\n\nsahie2014$statefips <- ifelse(nchar(sahie2014$statefips) == 1, paste0(\"0\", sahie2014$statefips), sahie2014$statefips)\nsahie2014$countyfips <- ifelse(nchar(sahie2014$countyfips) == 1, paste0(\"00\", sahie2014$countyfips), sahie2014$countyfips)\nsahie2014$countyfips <- ifelse(nchar(sahie2014$countyfips) == 2, paste0(\"0\", sahie2014$countyfips), sahie2014$countyfips)\nsahie2014$countyfips <- ifelse(nchar(sahie2014$countyfips) == 3, sahie2014$countyfip, sahie2014$countyfips)\nsahie2014$fips <- paste0(sahie2014$statefips, sahie2014$countyfips)\n\nct_sahie_2013 <- subset(sahie2013, State.Name==\"Connecticut\")\nct_sahie_2014 <- subset(sahie2014, State.Name==\"Connecticut\")\n\ncmap <- fortify(counties_composite(), region=\"fips\")\n\n\ncounties_sahie <- function(oldyear, newyear, column=\"PCTELIG\",\n                           age_cat=0, sex_cat=0, race_cat=0, ipr_cat=0,\n                           t=\"Temp title\", s=\"\", c=\"\") {\n  \n  working_adults_2013 <- oldyear %>%\n    filter(agecat==age_cat, sexcat==sex_cat, racecat==race_cat, iprcat==ipr_cat) \n  \n  working_adults_2013 <- working_adults_2013[c(\"fips\", \"State.Name\", column)]\n  \n  names(working_adults_2013)[names(working_adults_2013)==column] <- \"column\"\n  \n  \n  working_adults_2013 <- working_adults_2013  %>%\n    mutate(percent=as.numeric(column), column=round(as.numeric(column)/100,2))\n  \n\n  working_adults_2014 <- newyear %>%\n    filter(agecat==age_cat, sexcat==sex_cat, racecat==race_cat, iprcat==ipr_cat) \n  \n  working_adults_2014 <- working_adults_2014[c(\"fips\", \"State.Name\", column)]\n  \n  names(working_adults_2014)[names(working_adults_2014)==column] <- \"column\"\n  \n  working_adults_2014 <- working_adults_2014  %>%\n    mutate(percent=as.numeric(column), column=round(as.numeric(column)/100,2))\n    \n  # 2013-2014 diff\n  \n  working_adults_2014 <- select(working_adults_2014, fips, percent)\n  colnames(working_adults_2014) <- c(\"fips\", \"p2014\")\n  \n  working_adults <- left_join(working_adults_2013, working_adults_2014)\n  working_adults_compare <- working_adults\n  working_adults$diff <- (working_adults$percent-working_adults$p2014)\n  \n  working_adults <- select(working_adults, fips, State.Name, diff)\n  \n  gg <- ggplot()\n  gg <- gg + geom_map(data=cmap, map=cmap,\n                      aes(x=long, y=lat, map_id=id),\n                      color=\"#2b2b2b\", size=0.05, fill=NA)\n  gg <- gg + geom_map(data=working_adults, map=cmap,\n                      aes(fill=diff, map_id=fips),\n                      color=\"#2b2b2b\", size=0.05)\n  # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n  gg <- gg + scale_fill_viridis(name=\"Percent point change\")\n  gg <- gg + coord_proj(us_laea_proj)\n  gg <- gg + labs(title=t,\n                  subtitle=s,\n                  caption=c)\n  gg <- gg + theme_map(base_family=\"Arial Narrow\")\n  gg <- gg + theme(legend.position=c(0.8, 0.25))\n  gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n  gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n  print(gg)\n  \n  nrow(subset(working_adults, diff>=0))\n  nrow(subset(working_adults, diff<0))\n  \n  less <- nrow(subset(working_adults_compare, p2014 < percent)) \n  more <- nrow(subset(working_adults_compare, p2014 > percent))\n  \n  per_less <- round(less/(more+less)*100,2)\n  per_more <- round(more/(more+less)*100,2)\n  cat(\"less: \", per_less, \"% \\n\")\n  cat(\"more: \", per_more, \"%\")\n  \n  ct_working_adults_compare <- subset(working_adults_compare, State.Name==\"Connecticut\")\n  ct_working_adults_compare <- ct_working_adults_compare[c(\"fips\", \"percent\", \"p2014\")]\n  colnames(ct_working_adults_compare) <- c(\"fips\", \"y2013\", \"y2014\")\n  ct_working_adults_compare$diff <- ct_working_adults_compare$y2013 - ct_working_adults_compare$y2014\n  \n  write.csv(ct_working_adults_compare, paste0(\"data/\", gsub(\" \", \"\", t), \".csv\"))\n}\n\n\n# 18 - 64\n# agecat==1\n# sexcat==0\n# racecat==0\n# iprcat==0\n# PCTELIG\n\n\ncounties_sahie(sahie2013, sahie2014, column=\"PCTELIG\",\n               age_cat=1, sex_cat=0, race_cat=0, ipr_cat=0,\n               t=\"U.S. decrease of uninsured rate by county from 2013 to 2014 (18-64)\", \n               s=\"The estimated uninsured rate for working-age adults decreased in 72.1 percent of the nationâ€™s counties (or 2,262 counties) from 2013 to 2014.\", \n               c=\"SOURCE: Small Area Health Insurance Estimates, U.S. Census\")\n\n# Under 65\n# agecat==0\n# sexcat==0\n# racecat==0\n# iprcat==0\n# PCTELIG\n\ncounties_sahie(sahie2013, sahie2014, column=\"PCTELIG\",\n               age_cat=0, sex_cat=0, race_cat=0, ipr_cat=0,\n               t=\"U.S. decrease of uninsured rate by county from 2013 to 2014 (Under 64)\", \n               s=\"For the total population under age 65, the estimated uninsured rate decreased in 74.1 percent of counties (or 2,325 counties) \\nbetween 2013 and 2014. There were no statistically significant changes in 25.9 percent of counties, \\nand only one county experienced an increase in its uninsured rate.\", \n               c=\"SOURCE: Small Area Health Insurance Estimates, U.S. Census\")\n\n# working-age adults living at or below 138 percent of poverty\n# saw a decrease in the uninsured in 59.3 percent of counties (or 1,860 counties)\n# agecat==1\n# sexcat==0\n# racecat==0\n# iprcat==3 \n# PCTUI\n\ncounties_sahie(sahie2013, sahie2014, column=\"PCTUI\",\n               age_cat=1, sex_cat=0, race_cat=0, ipr_cat=3,\n               t=\"U.S. Decrease of Uninsured Rate by County from 2013 to 2014 (Adults in poverty)\", \n               s=\"Between 2013 and 2014, working-age adults living at or below 138 percent of poverty saw a decrease \\nin the uninsured in 59.3 percent of counties (or 1,860 counties).\", \n               c=\"SOURCE: Small Area Health Insurance Estimates, U.S. Census\")\n\n# Between 2013 and 2014, the uninsured rate decreased in 66.6 percent \n# of counties (or 2,089 counties) for working-age adults living between \n# 138 to 400 percent of poverty (which is the eligibility for subsidies\n# to purchase health insurance coverage through the exchanges).\n\n# agecat==1\n# sexcat==0\n# racecat==0\n# iprcat==5 \n# PCTELIG\n\ncounties_sahie(sahie2013, sahie2014, column=\"PCTELIG\",\n               age_cat=1, sex_cat=0, race_cat=0, ipr_cat=5,\n               t=\"U.S. Decrease of Uninsured Rate by County from 2013 to 2014 (Adults in poverty)\", \n               s=\"Between 2013 and 2014, the uninsured rate decreased in 66.6 percent of counties (or 2,089 counties) for working-age adults \\nliving between 138 to 400 percent of poverty (which is the eligibility for subsidies to purchase health insurance coverage through the exchanges).\", \n               c=\"SOURCE: Small Area Health Insurance Estimates, U.S. Census\")\n\n\n# Between 2013 and 2014, the uninsured rate decreased for children \n# under age 19 in 20.7 percent of counties (or 650 counties).\n# agecat==4\n# sexcat==0\n# racecat==0\n# iprcat==0\n# PCTELIG\n\ncounties_sahie(sahie2013, sahie2014, column=\"PCTELIG\",\n               age_cat=4, sex_cat=0, race_cat=0, ipr_cat=0,\n               t=\"U.S. Decrease of Uninsured Rate by County from 2013 to 2014 (Children)\", \n               s=\"Between 2013 and 2014, the uninsured rate decreased for children under age 19 in 20.7 percent of counties (or 650 counties)\", \n               c=\"SOURCE: Small Area Health Insurance Estimates, U.S. Census\")\n\n# Working-age males had a higher uninsured rate than females in \n# 40.1 percent of counties (or 1,259 counties); there were no statistically \n# significant differences in the remaining counties.\n\n# agecat==1\n# sexcat==1 & 2\n# racecat==0\n# iprcat==0 \n# PCTELIG\n\n\nworking_m_2014 <- sahie2014 %>%\n  filter(agecat==1, sexcat==1, racecat==0, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  mutate(percent=as.numeric(PCTELIG), PCTELIG=round(as.numeric(PCTELIG)/100,2))\n\nworking_f_2014 <- sahie2014 %>%\n  filter(agecat==1, sexcat==2, racecat==0, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(percent=as.numeric(PCTELIG), PCTELIG=round(as.numeric(PCTELIG)/100,2))\n\n# male-female diff\n\nworking_f_2014 <- select(working_f_2014, fips, percent)\ncolnames(working_f_2014) <- c(\"fips\", \"female\")\n\nworking_adults <- left_join(working_m_2014, working_f_2014)\nworking_m_f_compare <- working_adults\nworking_adults$diff <- (working_adults$percent-working_adults$female)\n\nworking_adults <- select(working_adults, fips, State.Name, diff)\n\n\ngg <- ggplot()\ngg <- gg + geom_map(data=cmap, map=cmap,\n                    aes(x=long, y=lat, map_id=id),\n                    color=\"#2b2b2b\", size=0.05, fill=NA)\ngg <- gg + geom_map(data=working_adults, map=cmap,\n                    aes(fill=diff, map_id=fips),\n                    color=\"#2b2b2b\", size=0.05)\n# gg <- gg + scale_fill_viridis(name=\"Uninsured\") \ngg <- gg + scale_fill_viridis(name=\"Percent point change\")\ngg <- gg + coord_proj(us_laea_proj)\ngg <- gg + labs(title=\"Male vs Female Uninsured rate in 2014\",\n                subtitle=\"Content SOURCE: Small Area Health Insurance Estimates, U.S. Census\",\n                caption=\"Data from http://www.cdc.gov/diabetes/atlas/countydata/County_ListofIndicators.html\")\ngg <- gg + theme_map(base_family=\"Arial Narrow\")\ngg <- gg + theme(legend.position=c(0.8, 0.25))\ngg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\ngg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\ngg\n\nnrow(subset(working_adults, diff>=0))\nnrow(subset(working_adults, diff<0))\n\nless <- nrow(subset(working_m_f_compare, p2014 < percent)) \nmore <- nrow(subset(working_m_f_compare, p2014 > percent))\n\nper_less <- round(less/(more+less)*100,2)\nper_more <- round(more/(more+less)*100,2)\n\n\n\n# 18 - 64 OLD VERSION\n# \n# working_adults_2013 <- sahie2013 %>%\n#   filter(agecat==1, sexcat==0, racecat==0, iprcat==0) %>%\n#   select(fips, State.Name, PCTELIG) %>%\n#   mutate(percent=as.numeric(PCTELIG), PCTELIG=round(as.numeric(PCTELIG)/100,2))\n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=working_adults_2013, map=cmap,\n#                     aes(fill=PCTELIG, map_id=fips),\n#                     color=\"#2b2b2b\", size=0.05)\n# # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n# gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + labs(title=\"U.S. Uninsured Rate by County in 2013 (18-64))\",\n#                 subtitle=\"Content SOURCE: Small Area Health Insurance Estimates, U.S. Census\",\n#                 caption=\"Data from http://www.cdc.gov/diabetes/atlas/countydata/County_ListofIndicators.html\")\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# \n# working_adults_2014 <- sahie2014 %>%\n#   filter(agecat==1, sexcat==0, racecat==0, iprcat==0) %>%\n#   select(fips, State.Name, PCTELIG) %>%\n#   #  mutate(PCTELIG=as.numeric(PCTELIG))\n#   mutate(percent=as.numeric(PCTELIG), PCTELIG=round(as.numeric(PCTELIG)/100,2))\n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=working_adults_2014, map=cmap,\n#                     aes(fill=PCTELIG, map_id=fips),\n#                     color=\"#2b2b2b\", size=0.05)\n# # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n# gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + labs(title=\"U.S. Uninsured Rate by County in 2014 (18-64)\",\n#                 subtitle=\"Content SOURCE: Small Area Health Insurance Estimates, U.S. Census\",\n#                 caption=\"Data from http://www.cdc.gov/diabetes/atlas/countydata/County_ListofIndicators.html\")\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# # 2013-2014 diff\n# \n# working_adults_2014 <- select(working_adults_2014, fips, percent)\n# colnames(working_adults_2014) <- c(\"fips\", \"p2014\")\n# \n# working_adults <- left_join(working_adults_2013, working_adults_2014)\n# working_adults_compare <- working_adults\n# working_adults$diff <- (working_adults$percent-working_adults$p2014)\n# \n# working_adults <- select(working_adults, fips, State.Name, diff)\n# \n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=working_adults, map=cmap,\n#                     aes(fill=diff, map_id=fips),\n#                     color=\"#2b2b2b\", size=0.05)\n# # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n# gg <- gg + scale_fill_viridis(name=\"Percent point change\")\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + labs(title=\"U.S. Decrease of Uninsured Rate by County from 2013 to 2014 (18-64)\",\n#                 subtitle=\"Content SOURCE: Small Area Health Insurance Estimates, U.S. Census\",\n#                 caption=\"Data from http://www.cdc.gov/diabetes/atlas/countydata/County_ListofIndicators.html\")\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# nrow(subset(working_adults, diff>=0))\n# nrow(subset(working_adults, diff<0))\n# \n# less <- nrow(subset(working_adults_compare, p2014 < percent)) \n# more <- nrow(subset(working_adults_compare, p2014 > percent))\n# \n# per_less <- round(less/(more+less)*100,2)\n# per_more <- round(more/(more+less)*100,2)\n\n\n## UNDER 65 OLD VERSION\n# \n# working_under_65_2013 <- sahie2013 %>%\n#   filter(agecat==0, sexcat==0, racecat==0, iprcat==0) %>%\n#   select(fips, State.Name, PCTELIG) %>%\n#   mutate(percent=as.numeric(PCTELIG), PCTELIG=round(as.numeric(PCTELIG)/100,2))\n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=working_under_65_2013, map=cmap,\n#                     aes(fill=PCTELIG, map_id=fips),\n#                     color=\"#2b2b2b\", size=0.05)\n# # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n# gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + labs(title=\"U.S. Uninsured Rate by County in 2013 (Under 65))\",\n#                 subtitle=\"Content SOURCE: Small Area Health Insurance Estimates, U.S. Census\",\n#                 caption=\"Data from http://www.cdc.gov/diabetes/atlas/countydata/County_ListofIndicators.html\")\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# \n# working_under_65_2014 <- sahie2014 %>%\n#   filter(agecat==0, sexcat==0, racecat==0, iprcat==0) %>%\n#   select(fips, State.Name, PCTELIG) %>%\n#   #  mutate(PCTELIG=as.numeric(PCTELIG))\n#   mutate(percent=as.numeric(PCTELIG), PCTELIG=round(as.numeric(PCTELIG)/100,2))\n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=working_under_65_2014, map=cmap,\n#                     aes(fill=PCTELIG, map_id=fips),\n#                     color=\"#2b2b2b\", size=0.05)\n# # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n# gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + labs(title=\"U.S. Uninsured Rate by County in 2014 (Under 65))\",\n#                 subtitle=\"Content SOURCE: Small Area Health Insurance Estimates, U.S. Census\",\n#                 caption=\"Data from http://www.cdc.gov/diabetes/atlas/countydata/County_ListofIndicators.html\")\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# # 2013-2014 diff\n# \n# working_under_65_2014 <- select(working_under_65_2014, fips, percent)\n# colnames(working_under_65_2014) <- c(\"fips\", \"p2014\")\n# \n# working_adults <- left_join(working_under_65_2013, working_under_65_2014)\n# working_under_65_compare <- working_adults\n# working_adults$diff <- (working_adults$percent-working_adults$p2014)\n# \n# working_adults <- select(working_adults, fips, State.Name, diff)\n# \n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=working_adults, map=cmap,\n#                     aes(fill=diff, map_id=fips),\n#                     color=\"#2b2b2b\", size=0.05)\n# # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n# gg <- gg + scale_fill_viridis(name=\"Percent point change\")\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + labs(title=\"U.S. Decrease of Uninsured Rate by County from 2013 to 2014 (Under 65)\",\n#                 subtitle=\"Content SOURCE: Small Area Health Insurance Estimates, U.S. Census\",\n#                 caption=\"Data from http://www.cdc.gov/diabetes/atlas/countydata/County_ListofIndicators.html\")\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# nrow(subset(working_adults, diff>=0))\n# nrow(subset(working_adults, diff<0))\n# \n# less <- nrow(subset(working_under_65_compare, p2014 < percent)) \n# more <- nrow(subset(working_under_65_compare, p2014 > percent))\n# \n# per_less <- round(less/(more+less)*100,2)\n# per_more <- round(more/(more+less)*100,2)\n\n\n\n\n# working-age adults living at or below 138 percent of poverty OLD VERSION\n# \n# working_below_138_2013 <- sahie2013 %>%\n#   filter(agecat==1, sexcat==0, racecat==0, iprcat==3) %>%\n#   select(fips, State.Name, PCTUI) %>%\n#   mutate(percent=as.numeric(PCTUI), PCTUI=round(as.numeric(PCTUI)/100,2))\n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=working_below_138_2013, map=cmap,\n#                     aes(fill=PCTUI, map_id=fips),\n#                     color=\"#2b2b2b\", size=0.05)\n# # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n# gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + labs(title=\"U.S. Uninsured Rate by County in 2013 (Adults in poverty))\",\n#                 subtitle=\"Content SOURCE: Small Area Health Insurance Estimates, U.S. Census\",\n#                 caption=\"Data from http://www.cdc.gov/diabetes/atlas/countydata/County_ListofIndicators.html\")\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# \n# working_below_138_2014 <- sahie2014 %>%\n#   filter(agecat==1, sexcat==0, racecat==0, iprcat==3) %>%\n#   select(fips, State.Name, PCTUI) %>%\n#   #  mutate(PCTUI=as.numeric(PCTUI))\n#   mutate(percent=as.numeric(PCTUI), PCTUI=round(as.numeric(PCTUI)/100,2))\n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=working_below_138_2014, map=cmap,\n#                     aes(fill=PCTUI, map_id=fips),\n#                     color=\"#2b2b2b\", size=0.05)\n# # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n# gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + labs(title=\"U.S. Uninsured Rate by County in 2014 (Adults in poverty))\",\n#                 subtitle=\"Content SOURCE: Small Area Health Insurance Estimates, U.S. Census\",\n#                 caption=\"Data from http://www.cdc.gov/diabetes/atlas/countydata/County_ListofIndicators.html\")\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# # 2013-2014 diff\n# \n# working_below_138_2014 <- select(working_below_138_2014, fips, percent)\n# colnames(working_below_138_2014) <- c(\"fips\", \"p2014\")\n# \n# working_adults <- left_join(working_below_138_2013, working_below_138_2014)\n# working_below_138_compare <- working_adults\n# working_adults$diff <- (working_adults$percent-working_adults$p2014)\n# \n# working_adults <- select(working_adults, fips, State.Name, diff)\n# \n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=working_adults, map=cmap,\n#                     aes(fill=diff, map_id=fips),\n#                     color=\"#2b2b2b\", size=0.05)\n# # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n# gg <- gg + scale_fill_viridis(name=\"Percent point change\")\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + labs(title=\"U.S. Decrease of Uninsured Rate by County from 2013 to 2014 (Adults in poverty)\",\n#                 subtitle=\"Content SOURCE: Small Area Health Insurance Estimates, U.S. Census\",\n#                 caption=\"Data from http://www.cdc.gov/diabetes/atlas/countydata/County_ListofIndicators.html\")\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# nrow(subset(working_adults, diff>=0))\n# nrow(subset(working_adults, diff<0))\n# \n# less <- nrow(subset(working_below_138_compare, p2014 < percent)) \n# more <- nrow(subset(working_below_138_compare, p2014 > percent))\n# \n# per_less <- round(less/(more+less)*100,2)\n# per_more <- round(more/(more+less)*100,2)\n\n\n\n# Between 2013 and 2014, the uninsured rate decreased in 66.6 percent OLD VERSION\n# \n# working_adults_2013 <- sahie2013 %>%\n#   filter(agecat==1, sexcat==0, racecat==0, iprcat==5) %>%\n#   select(fips, State.Name, PCTELIG) %>%\n#   mutate(percent=as.numeric(PCTELIG), PCTELIG=round(as.numeric(PCTELIG)/100,2))\n# \n# working_adults_2014 <- sahie2014 %>%\n#   filter(agecat==1, sexcat==0, racecat==0, iprcat==0) %>%\n#   select(fips, State.Name, PCTELIG) %>%\n#   #  mutate(PCTELIG=as.numeric(PCTELIG))\n#   mutate(percent=as.numeric(PCTELIG), PCTELIG=round(as.numeric(PCTELIG)/100,2))\n# # 2013-2014 diff\n# \n# working_adults_2014 <- select(working_adults_2014, fips, percent)\n# colnames(working_adults_2014) <- c(\"fips\", \"p2014\")\n# \n# working_adults <- left_join(working_adults_2013, working_adults_2014)\n# working_adults_compare <- working_adults\n# working_adults$diff <- (working_adults$percent-working_adults$p2014)\n# \n# working_adults <- select(working_adults, fips, State.Name, diff)\n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=working_adults, map=cmap,\n#                     aes(fill=diff, map_id=fips),\n#                     color=\"#2b2b2b\", size=0.05)\n# # gg <- gg + scale_fill_viridis(name=\"Uninsured\") \n# gg <- gg + scale_fill_viridis(name=\"Percent point change\")\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + labs(title=\"U.S. Decrease of Uninsured Rate by County from 2013 to 2014 (Adults in poverty)\",\n#                 subtitle=\"Between 2013 and 2014, the uninsured rate decreased in 66.6 percent of counties (or 2,089 counties) for working-age adults \\nliving between 138 to 400 percent of poverty (which is the eligibility for subsidies to purchase health insurance coverage through the exchanges).\",\n#                 caption=\"SOURCE: Small Area Health Insurance Estimates, U.S. Census\")\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# nrow(subset(working_adults, diff>=0))\n# nrow(subset(working_adults, diff<0))\n# \n# less <- nrow(subset(working_adults_compare, p2014 < percent)) \n# more <- nrow(subset(working_adults_compare, p2014 > percent))\n# \n# per_less <- round(less/(more+less)*100,2)\n# per_more <- round(more/(more+less)*100,2)\n\n# In 2014, for the population under age 65, non-Hispanic whites had a lower \n# uninsured rate than both Hispanics and non-Hispanic blacks in every state and Washington, D.C.\n\n# agecat==0\n# sexcat==0\n# racecat==1 & 2 & 3\n# iprcat==0 \n# PCTELIG\n# PCTUI\n\n\nsahie2008 <- read.csv(\"data/sahie_2008.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2008$State.Name <- str_trim(sahie2008$State.Name)\nsahie2014 <- read.csv(\"data/sahie_2014.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2014$State.Name <- str_trim(sahie2014$State.Name)\n\nsahie2008$statefips <- as.character(sahie2008$statefips)\nsahie2008$countyfips <- as.character(sahie2008$countyfips)\n\nsahie2008$statefips <- ifelse(nchar(sahie2008$statefips) == 1, paste0(\"0\", sahie2008$statefips), sahie2008$statefips)\nsahie2008$countyfips <- ifelse(nchar(sahie2008$countyfips) == 1, paste0(\"00\", sahie2008$countyfips), sahie2008$countyfips)\nsahie2008$countyfips <- ifelse(nchar(sahie2008$countyfips) == 2, paste0(\"0\", sahie2008$countyfips), sahie2008$countyfips)\nsahie2008$countyfips <- ifelse(nchar(sahie2008$countyfips) == 3, sahie2008$countyfip, sahie2008$countyfips)\nsahie2008$fips <- paste0(sahie2008$statefips, sahie2008$countyfips)\nct_sahie_2008 <- subset(sahie2008, State.Name==\"Connecticut\")\n\n\nsahie2009 <- read.csv(\"data/sahie_2009.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2009$State.Name <- str_trim(sahie2009$State.Name)\nsahie2014 <- read.csv(\"data/sahie_2014.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2014$State.Name <- str_trim(sahie2014$State.Name)\n\nsahie2009$statefips <- as.character(sahie2009$statefips)\nsahie2009$countyfips <- as.character(sahie2009$countyfips)\n\nsahie2009$statefips <- ifelse(nchar(sahie2009$statefips) == 1, paste0(\"0\", sahie2009$statefips), sahie2009$statefips)\nsahie2009$countyfips <- ifelse(nchar(sahie2009$countyfips) == 1, paste0(\"00\", sahie2009$countyfips), sahie2009$countyfips)\nsahie2009$countyfips <- ifelse(nchar(sahie2009$countyfips) == 2, paste0(\"0\", sahie2009$countyfips), sahie2009$countyfips)\nsahie2009$countyfips <- ifelse(nchar(sahie2009$countyfips) == 3, sahie2009$countyfip, sahie2009$countyfips)\nsahie2009$fips <- paste0(sahie2009$statefips, sahie2009$countyfips)\nct_sahie_2009 <- subset(sahie2009, State.Name==\"Connecticut\")\n\n\nsahie2010 <- read.csv(\"data/sahie_2010.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2010$State.Name <- str_trim(sahie2010$State.Name)\nsahie2014 <- read.csv(\"data/sahie_2014.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2014$State.Name <- str_trim(sahie2014$State.Name)\n\nsahie2010$statefips <- as.character(sahie2010$statefips)\nsahie2010$countyfips <- as.character(sahie2010$countyfips)\n\nsahie2010$statefips <- ifelse(nchar(sahie2010$statefips) == 1, paste0(\"0\", sahie2010$statefips), sahie2010$statefips)\nsahie2010$countyfips <- ifelse(nchar(sahie2010$countyfips) == 1, paste0(\"00\", sahie2010$countyfips), sahie2010$countyfips)\nsahie2010$countyfips <- ifelse(nchar(sahie2010$countyfips) == 2, paste0(\"0\", sahie2010$countyfips), sahie2010$countyfips)\nsahie2010$countyfips <- ifelse(nchar(sahie2010$countyfips) == 3, sahie2010$countyfip, sahie2010$countyfips)\nsahie2010$fips <- paste0(sahie2010$statefips, sahie2010$countyfips)\nct_sahie_2010 <- subset(sahie2010, State.Name==\"Connecticut\")\n\n\nsahie2011 <- read.csv(\"data/sahie_2011.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2011$State.Name <- str_trim(sahie2011$State.Name)\nsahie2014 <- read.csv(\"data/sahie_2014.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2014$State.Name <- str_trim(sahie2014$State.Name)\n\nsahie2011$statefips <- as.character(sahie2011$statefips)\nsahie2011$countyfips <- as.character(sahie2011$countyfips)\n\nsahie2011$statefips <- ifelse(nchar(sahie2011$statefips) == 1, paste0(\"0\", sahie2011$statefips), sahie2011$statefips)\nsahie2011$countyfips <- ifelse(nchar(sahie2011$countyfips) == 1, paste0(\"00\", sahie2011$countyfips), sahie2011$countyfips)\nsahie2011$countyfips <- ifelse(nchar(sahie2011$countyfips) == 2, paste0(\"0\", sahie2011$countyfips), sahie2011$countyfips)\nsahie2011$countyfips <- ifelse(nchar(sahie2011$countyfips) == 3, sahie2011$countyfip, sahie2011$countyfips)\nsahie2011$fips <- paste0(sahie2011$statefips, sahie2011$countyfips)\nct_sahie_2011 <- subset(sahie2011, State.Name==\"Connecticut\")\n\n\nsahie2012 <- read.csv(\"data/sahie_2012.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2012$State.Name <- str_trim(sahie2012$State.Name)\nsahie2014 <- read.csv(\"data/sahie_2014.csv\", skip=78, stringsAsFactors=FALSE)\nsahie2014$State.Name <- str_trim(sahie2014$State.Name)\n\nsahie2012$statefips <- as.character(sahie2012$statefips)\nsahie2012$countyfips <- as.character(sahie2012$countyfips)\n\nsahie2012$statefips <- ifelse(nchar(sahie2012$statefips) == 1, paste0(\"0\", sahie2012$statefips), sahie2012$statefips)\nsahie2012$countyfips <- ifelse(nchar(sahie2012$countyfips) == 1, paste0(\"00\", sahie2012$countyfips), sahie2012$countyfips)\nsahie2012$countyfips <- ifelse(nchar(sahie2012$countyfips) == 2, paste0(\"0\", sahie2012$countyfips), sahie2012$countyfips)\nsahie2012$countyfips <- ifelse(nchar(sahie2012$countyfips) == 3, sahie2012$countyfip, sahie2012$countyfips)\nsahie2012$fips <- paste0(sahie2012$statefips, sahie2012$countyfips)\nct_sahie_2012 <- subset(sahie2012, State.Name==\"Connecticut\")\n\nworking_w_2014 <- ct_sahie_2014 %>%\n  filter(agecat==0, sexcat==0, racecat==1, iprcat==0, geocat==40) %>%\n  select(fips, State.Name, PCTUI) %>%\n  mutate(w_percent=as.numeric(PCTUI)) %>%\n  select(fips, w_percent)\n\nworking_b_2014 <- ct_sahie_2014 %>%\n  filter(agecat==0, sexcat==0, racecat==2, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(b_percent=as.numeric(PCTELIG)) %>%\n  select(fips, b_percent)\n\nworking_h_2014 <- ct_sahie_2014 %>%\n  filter(agecat==0, sexcat==0, racecat==3, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(h_percent=as.numeric(PCTELIG)) %>%\n  select(fips, h_percent)\n\nworking_r_2014 <- left_join(working_w_2014, working_b_2014)\nworking_r_2014 <- left_join(working_r_2014, working_h_2014)\n\n\n\n\nworking_w_2013 <- ct_sahie_2013 %>%\n  filter(agecat==0, sexcat==0, racecat==1, iprcat==0, geocat==40) %>%\n  select(fips, State.Name, PCTUI) %>%\n  mutate(w_percent=as.numeric(PCTUI)) %>%\n  select(fips, w_percent)\n\nworking_b_2013 <- ct_sahie_2013 %>%\n  filter(agecat==0, sexcat==0, racecat==2, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(b_percent=as.numeric(PCTELIG)) %>%\n  select(fips, b_percent)\n\nworking_h_2013 <- ct_sahie_2013 %>%\n  filter(agecat==0, sexcat==0, racecat==3, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(h_percent=as.numeric(PCTELIG)) %>%\n  select(fips, h_percent)\n\nworking_r_2013 <- left_join(working_w_2013, working_b_2013)\nworking_r_2013 <- left_join(working_r_2013, working_h_2013)\n\n\nworking_w_2008 <- ct_sahie_2008 %>%\n  filter(agecat==0, sexcat==0, racecat==1, iprcat==0, geocat==40) %>%\n  select(fips, State.Name, PCTUI) %>%\n  mutate(w_percent=as.numeric(PCTUI)) %>%\n  select(fips, w_percent)\n\nworking_b_2008 <- ct_sahie_2008 %>%\n  filter(agecat==0, sexcat==0, racecat==2, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(b_percent=as.numeric(PCTELIG)) %>%\n  select(fips, b_percent)\n\nworking_h_2008 <- ct_sahie_2008 %>%\n  filter(agecat==0, sexcat==0, racecat==3, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(h_percent=as.numeric(PCTELIG)) %>%\n  select(fips, h_percent)\n\nworking_r_2008 <- left_join(working_w_2008, working_b_2008)\nworking_r_2008 <- left_join(working_r_2008, working_h_2008)\n\n\nworking_w_2009 <- ct_sahie_2009 %>%\n  filter(agecat==0, sexcat==0, racecat==1, iprcat==0, geocat==40) %>%\n  select(fips, State.Name, PCTUI) %>%\n  mutate(w_percent=as.numeric(PCTUI)) %>%\n  select(fips, w_percent)\n\nworking_b_2009 <- ct_sahie_2009 %>%\n  filter(agecat==0, sexcat==0, racecat==2, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(b_percent=as.numeric(PCTELIG)) %>%\n  select(fips, b_percent)\n\nworking_h_2009 <- ct_sahie_2009 %>%\n  filter(agecat==0, sexcat==0, racecat==3, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(h_percent=as.numeric(PCTELIG)) %>%\n  select(fips, h_percent)\n\nworking_r_2009 <- left_join(working_w_2009, working_b_2009)\nworking_r_2009 <- left_join(working_r_2009, working_h_2009)\n\n\nworking_w_2010 <- ct_sahie_2010 %>%\n  filter(agecat==0, sexcat==0, racecat==1, iprcat==0, geocat==40) %>%\n  select(fips, State.Name, PCTUI) %>%\n  mutate(w_percent=as.numeric(PCTUI)) %>%\n  select(fips, w_percent)\n\nworking_b_2010 <- ct_sahie_2010 %>%\n  filter(agecat==0, sexcat==0, racecat==2, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(b_percent=as.numeric(PCTELIG)) %>%\n  select(fips, b_percent)\n\nworking_h_2010 <- ct_sahie_2010 %>%\n  filter(agecat==0, sexcat==0, racecat==3, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(h_percent=as.numeric(PCTELIG)) %>%\n  select(fips, h_percent)\n\nworking_r_2010 <- left_join(working_w_2010, working_b_2010)\nworking_r_2010 <- left_join(working_r_2010, working_h_2010)\n\n\nworking_w_2011 <- ct_sahie_2011 %>%\n  filter(agecat==0, sexcat==0, racecat==1, iprcat==0, geocat==40) %>%\n  select(fips, State.Name, PCTUI) %>%\n  mutate(w_percent=as.numeric(PCTUI)) %>%\n  select(fips, w_percent)\n\nworking_b_2011 <- ct_sahie_2011 %>%\n  filter(agecat==0, sexcat==0, racecat==2, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(b_percent=as.numeric(PCTELIG)) %>%\n  select(fips, b_percent)\n\nworking_h_2011 <- ct_sahie_2011 %>%\n  filter(agecat==0, sexcat==0, racecat==3, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(h_percent=as.numeric(PCTELIG)) %>%\n  select(fips, h_percent)\n\nworking_r_2011 <- left_join(working_w_2011, working_b_2011)\nworking_r_2011 <- left_join(working_r_2011, working_h_2011)\n\n\nworking_w_2012 <- ct_sahie_2012 %>%\n  filter(agecat==0, sexcat==0, racecat==1, iprcat==0, geocat==40) %>%\n  select(fips, State.Name, PCTUI) %>%\n  mutate(w_percent=as.numeric(PCTUI)) %>%\n  select(fips, w_percent)\n\nworking_b_2012 <- ct_sahie_2012 %>%\n  filter(agecat==0, sexcat==0, racecat==2, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(b_percent=as.numeric(PCTELIG)) %>%\n  select(fips, b_percent)\n\nworking_h_2012 <- ct_sahie_2012 %>%\n  filter(agecat==0, sexcat==0, racecat==3, iprcat==0) %>%\n  select(fips, State.Name, PCTELIG) %>%\n  #  mutate(PCTELIG=as.numeric(PCTELIG))\n  mutate(h_percent=as.numeric(PCTELIG)) %>%\n  select(fips, h_percent)\n\nworking_r_2012 <- left_join(working_w_2012, working_b_2012)\nworking_r_2012 <- left_join(working_r_2012, working_h_2012)\n\ntemp1 <- data.frame(t(working_r_2013))\ntemp2 <- data.frame(t(working_r_2014))\ntemp3 <- data.frame(t(working_r_2008))\ntemp4 <- data.frame(t(working_r_2009))\ntemp5 <- data.frame(t(working_r_2010))\ntemp6 <- data.frame(t(working_r_2011))\ntemp7 <- data.frame(t(working_r_2012))\n\n\ntemp <- cbind(temp3, temp4, temp5, temp6, temp7, temp1, temp2)\ntemp$type <- rownames(temp)\nrownames(temp) <- NULL\ntemp <- temp[-1,]\n\ncolnames(temp) <- c(\"2008\", \"2009\", \"2010\", \"2011\", \"2012\", \"2013\", \"2014\", \"Ethnicity\")\ntemp <- temp[c(\"Ethnicity\", \"2008\", \"2009\", \"2010\", \"2011\", \"2012\", \"2013\", \"2014\")]\ntemp$Ethnicity <- gsub(\"w_percent\", \"White\", temp$Ethnicity)\ntemp$Ethnicity <- gsub(\"b_percent\", \"Black\", temp$Ethnicity)\ntemp$Ethnicity <- gsub(\"h_percent\", \"Hispanic\", temp$Ethnicity)\n\ntemp2 <- gather(temp, \"Year\", \"Uninsured\", 2:8)\ntemp2$Uninsured <- as.numeric(temp2$Uninsured)\ntemp2$Year <- as.factor(temp2$Year)\n\nsource(\"slopegraph.r\")\n\ndf <- build_slopegraph(temp2, x=\"Year\", y=\"Uninsured\", group=\"Ethnicity\", method=\"tufte\", min.space=0.05)\n\n## Refactor the x-axis to get the right labels, round the y values for presentation\ndf <- transform(df, x=factor(x, levels=c(2008, 2009, 2010, 2011, 2012, 2013,2014),\n                             labels=c(\"2008\", \"2009\", \"2010\", \"2011\", \"2012\", \"2013\", \"2014\")),\n                y=round(y))\n##' Generate the raw plot\ngg.form <- plot_slopegraph(df) +\n  labs(title=\"Percent of uninsured by ethnicity in Connecticut\",\n       subtitle=\"Most major provisions of the Patient Protection and Affordable Care Act were phased in by January 2014.\",\n       caption=\"SOURCE: Small Area Health Insurance Estimates, U.S. Census\") \ngg.form <- gg.form + theme_text(base_family=\"Arial Narrow\")\n#gg.form <- gg.form + theme(legend.position=c(0.8, 0.25))\ngg.form <- gg.form + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6,l=-20)))\ngg.form <- gg.form + theme(plot.subtitle=element_text(size=10, margin=margin(b=6)))\ngg.form <- gg.form + theme(plot.caption=element_text(size=9, margin=margin(t=16)))\n\ngg.form\n\n\n\n\n# write.csv(working_r_2014, \"data/working_r_2014.csv\")\n# For the population under age 65 living at or below 138 percent of poverty, \n# non-Hispanic blacks had a lower uninsured rate than non-Hispanic whites in 28 states.\n\n# agecat==0\n# sexcat==0\n# racecat==3 & 2\n# iprcat==3 \n# PCTELIG\n\n\n## CDC 2015\ncdc <- read.csv(\"data/cdc_2015.csv\", stringsAsFactors=FALSE)\n\ncdc_under65 <- cdc %>%\n  filter(Type==\"Persons under 65\") %>%\n  filter(grepl(\"full year\", year_and_quarter)) %>%\n  mutate(year_and_quarter=gsub(\" full year\", \"\", year_and_quarter)) %>%\n  select(year_and_quarter, Uninsured1, Private, Public) %>%\n  gather(\"Year\", \"Type\", 2:4)\n\ncolnames(cdc_under65) <- c(\"Year\", \"Type\", \"Percent\")\ncdc_under65$Type <- gsub(\"Uninsured1\", \"Uninsured\", cdc_under65$Type)\n\n\ndf <- build_slopegraph(cdc_under65, x=\"Year\", y=\"Percent\", group=\"Type\", method=\"tufte\", min.space=0.05)\n\n## Refactor the x-axis to get the right labels, round the y values for presentation\ndf <- transform(df, x=factor(x, levels=c(2010, 2011, 2012, 2013,2014, 2015),\n                             labels=c(\"2010\", \"2011\", \"2012\", \"2013\", \"2014\", \"2015\")),\n                y=round(y))\n#write.csv(df, \"fixthisslope.csv\")\n\ndf <- read.csv(\"fixthisslope.csv\")\n\n##' Generate the raw plot\ngg.form <- plot_slopegraph(df) +\n  labs(title=\"Percent of insured and uninsured in the United States\",\n       subtitle=\"In 2015, 28.6 million persons of all ages (9.1 percent) were uninsuredâ€”\\nabout 7.4 million fewer persons than in 2014.\",\n       caption=\"SOURCE: NCHS, National Health Interview Survey, 1997â€“2015\") \ngg.form <- gg.form + theme_text(base_family=\"Arial Narrow\")\n#gg.form <- gg.form + theme(legend.position=c(0.8, 0.25))\ngg.form <- gg.form + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6,l=-20)))\ngg.form <- gg.form + theme(plot.subtitle=element_text(size=10, margin=margin(b=6)))\ngg.form <- gg.form + theme(plot.caption=element_text(size=9, margin=margin(t=16)))\n\ngg.form\n\n",
    "created" : 1465478572868.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4249574572",
    "id" : "F75FC918",
    "lastKnownWriteTime" : 1463624965,
    "last_content_update" : 1463624965,
    "path" : "~/Documents/Github/data/2016/05/sahie/analysis.R",
    "project_path" : "analysis.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}